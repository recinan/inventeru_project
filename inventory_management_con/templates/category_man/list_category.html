{% extends 'partials/_base.html' %}
{% load crispy_forms_tags %}
{% block content %}

<!-- Go Back Butonu -->
<div class="go-back-button">
    <a href="{% url 'list-warehouse' %}" class="btn btn-outline-primary my-3 mx-4">Go Back</a>

</div>

<!-- Ana İçerik -->
<div class="content-wrapper mt-4">

  <!-- Satır -->
  <div class="row gx-3 gy-4">

    <!-- Sol Sütun (Kategoriler) -->
    <div class="col-12 col-md-3">
      <div class="px-2 py-3 border rounded">
        <!-- Arama Alanı -->
        <div class="input-group mb-3">
          <input class="form-control" id="searchTerm" placeholder="Enter search term..." type="text">
          <select id="searchType" class="form-control">
            <option value="category">Search Category</option>
            <option value="item">Search Item</option>
          </select>
          <button class="btn btn-primary" onclick="performSearch()">Search</button>
        </div>
        <hr>
        <!-- Kategori Listesi -->
        {% for category in categorylist %}
          <div class="card mb-3 category-card">
            <div class="card-body text-center">
              <h5 class="card-title">{{ category.category_name }}</h5>
              <div class="btn-group">
                <a href="{% url 'add-item-warehouse' category.warehouse.slug category.slug %}" class="btn btn-outline-primary btn-sm">Add</a>
                <a href="{% url 'delete-category' category.slug %}" class="btn btn-outline-danger btn-sm">Delete</a>
                <a href="{% url 'warehouse-detail-pdf' category.warehouse.slug category.slug %}" class="btn btn-outline-success btn-sm">Download</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Sağ Sütun (Ürünler) -->
    <div class="col-12 col-md-9">
      <h1 class="mb-3">{{ warehouse.warehouse_name }}</h1>
      <hr>
      <!-- Ürün Tablosu -->
      <div class="table-responsive px-2">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in all_items %}
              <tr class="item-row">
                <td>{{ item.id }}</td>
                <td>{{ item.item_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.price }}</td>
                <td>{{ item.description }}</td>
                <td>
                  <div class="btn-group">
                    <a href="{% url 'item-detail' item.warehouse.slug item.category.slug item.slug %}" class="btn btn-outline-dark btn-sm">Details</a>
                    <a href="{% url 'delete-item' item.id %}" class="btn btn-outline-danger btn-sm">Delete</a>
                    <a href="{% url 'item-detail-pdf' item.warehouse.slug item.category.slug item.slug %}" class="btn btn-outline-success btn-sm">Download</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>

</div>

<script>
  // Arama Fonksiyonu
  function performSearch() {
    const searchTerm = document.getElementById('searchTerm').value.toLowerCase();
    const searchType = document.getElementById('searchType').value;

    if (searchType === 'category') {
      document.querySelectorAll('.category-card').forEach(card => {
        const categoryName = card.querySelector('.card-title').textContent.toLowerCase();
        card.style.display = categoryName.includes(searchTerm) ? '' : 'none';
      });
    } else if (searchType === 'item') {
      document.querySelectorAll('.item-row').forEach(row => {
        const itemName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
        row.style.display = itemName.includes(searchTerm) ? '' : 'none';
      });
    }
  }
</script>

{% endblock %}
